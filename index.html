<html>
<head>
<link href="css/simple.css" rel="stylesheet" type="text/css">
<script src='js/jquery.js'></script>
<script src='js/ajax_global_handlers.js'></script>

<script>
  $(document).ready(function(){

    var buildArticleHTML = function(article){
       // create HTML for one article
        // $ before variable name signals this was set by jquery
        var $articleHTML = $("<dt>").attr('id', article.id).text(article.title);
        $articleHTML.append($("<dd>").text(article.body));
        return $articleHTML;
    };

    var allArticlesCallback = function(articles){
      console.log("Articles = " + articles);
      articles.forEach(function(article){
        // Add it the list of articles
        $('#articles').append(buildArticleHTML(article));

      }); // end forEach
    };  // end allArticlesCallback

    $.ajax({
      url: 'http://localhost:3000/articles'
    }).done(allArticlesCallback);

     var newArticleCallback = function(article){
          // Add The article to the article list
          $('#articles').append(buildArticleHTML(article));
     };

    $('#new-article').submit(function(event){
      var $form = $(event.target),
      $title = $form.find("input[name='title']").val(),
      $body = $form.find("input[name='body']").val(),
      action = $form.attr('action');

      event.preventDefault();
      $.ajax({
        url: action,
        type: 'POST',
        data: {article: {title: $title, body: $body}},
        success: newArticleCallback
      })
    });
  });
</script>
</head>
<body>
  <h3>Articles SPA</h3>
  <!-- Busy Spinner -->
  <div id='ajaxSpinnerContainer', class='centered'>
    <img src="images/ajax-loader.gif" id="ajaxSpinnerImage" title="Working">
  </div>

  <!-- Show errors, warnings and happy thoughts -->
  <div id='msg'></div>

  <form id="new-article" action="http://localhost:3000/articles">
    <input type="text" name="title" placeholder="Enter a new title">
    <input type='textarea' name="body" placeholder="Enter new comments">
    <input type='submit' value="Create Article">
  </form>

  <dl id='articles'>Articles
  </dl>

</body>
</html>